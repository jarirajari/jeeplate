<!--
 ! Jeeplate
 ! Copyright (C) 2014 Jari Kuusisto
 ! 
 ! This program is free software: you can redistribute it and/or modify
 ! it under the terms of the GNU General Public License as published by
 ! the Free Software Foundation, either version 3 of the License, or
 ! (at your option) any later version.
 ! 
 ! This program is distributed in the hope that it will be useful,
 ! but WITHOUT ANY WARRANTY; without even the implied warranty of
 ! MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 ! GNU General Public License for more details.
 ! 
 ! You should have received a copy of the GNU General Public License
 ! along with this program. If not, see <http://www.gnu.org/licenses/>.
 ! 
 !-->
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" 
      xmlns:h="http://xmlns.jcp.org/jsf/html" 
      xmlns:f="http://xmlns.jcp.org/jsf/core" 
      xmlns:p="http://primefaces.org/ui" >
    <body>
        <!-- Menubar -->
        <h:form id="menubarForm">
            <p:growl id="messages" showDetail="true" life="3000" />
            <p:menubar>
                <p:menuitem id="logo">
                    <p:outputLabel>
                        <p:graphicImage style="height:25px;width:25px" value="resources/images/football.png" />
                    </p:outputLabel>
                    <p:outputLabel value="JEE" />
                </p:menuitem>

                <f:facet name="options">
                    <p:splitButton value="#{switchRoleMenu.currentUser()}" immediate="true" rendered="#{mgr.authenticated()}" actionListener="#{buttonView.clickedRoleSwitchedButton()}" icon="ui-icon-disk">
                        <p:menuitem value="Change credentials..." onclick="PF('credentialsDlg').show();" actionListener="#{oracle.noop()}" update="messages" icon="ui-icon-arrowrefresh-1-w" />
                        <p:menuitem value="Change localisation..." onclick="PF('localisationDlg').show();" actionListener="#{oracle.noop()}" update="messages" icon="ui-icon-arrowrefresh-1-w" />
                        <p:menuitem value="Account settings..." action="account" actionListener="#{oracle.noop()}" update="messages" icon="ui-icon-arrowrefresh-1-w" />
                    </p:splitButton>
                    
                    <p:commandButton id="dynaButton" value="Sign as" rendered="#{mgr.authenticated()}" icon="ui-icon-extlink">
                    </p:commandButton>
                    <p:menu id="rolesMenu" overlay="true" my="left top" at="left bottom" trigger="dynaButton" model="#{switchRoleMenu.switchRoleMenuModel}" />
                    
                    <p:commandButton value="Sign up" rendered="#{not mgr.authenticated()}" icon="ui-icon-disk"
                                     onclick="PF('signupWzd').show();">
                    </p:commandButton>

                    <p:commandButton value="Sign in" rendered="#{not mgr.authenticated()}" icon="ui-icon-disk"
                                     onclick="PF('signinDlg').show();">
                    </p:commandButton>

                    <p:commandButton value="Sign out" rendered="#{mgr.authenticated()}" icon="ui-icon-disk"
                                     ajax="false" action="#{mgr.doLogout}">
                    </p:commandButton>
                    
                    <!-- Primefaces' splitbutton cannot process dynamic lists, so we use this -->

                    <p:selectOneMenu id="syslang" styleClass="selectLang" valueChangeListener="#{language.changeLanguage}" value="#{language.selectedLocale}">
                        <p:ajax update="@all" />
                        <f:selectItems value="#{language.availableLocales.entrySet()}" var="locales" itemLabel="#{locales.value}" itemValue="#{locales.key}"/>
                        
                    </p:selectOneMenu>
                </f:facet>
            </p:menubar>
        </h:form>
        <!-- /Menubar -->
        <!-- Signup dialog -->
        <p:dialog widgetVar="signupWzd" header="Sign up" modal="true" styleClass="disable-scroll" width="600px">
            <h:form id="signupForm">
                <p:growl id="signupFormGrowl" sticky="true" showDetail="true"/>
                <p:wizard widgetVar="signupWzdWizard" flowListener="#{registrationView.onFlowProcess}" backLabel="Cancel" nextLabel="OK" showNavBar="true">
                    <!-- Send email if information is correct -->
                    <p:tab id="signupWzd0" title="Register Account">
                        <p:panel header="Register Account2">
                            <p:messages showDetail="false" showIcon="false" closable="true"/>
                            <h:panelGrid columns="2" columnClasses="label, value">
                                <h:outputText value="Email:" />
                                <h:inputText id="suemv" label="Email" value="#{registrationView.username}" required="true">
                                    <f:validator parent="suemv" validatorId="emailValidator" />
                                </h:inputText>

                                <h:outputText value="Mobile:" />
                                <h:inputText id="sumev" label="Mobile" value="#{registrationView.mobile}" required="true">
                                    <f:validator parent="sumev" validatorId="mobileValidator" />
                                </h:inputText>

                                <h:outputLabel for="signupWzdAccept" value="">
                                    <p:commandLink id="signupWzdAccept" value="Terms and Conditions" onclick="PF('termsCondsDialog').show();" oncomplete="PF('signinDlg').hide()"/>
                                </h:outputLabel>
                                <p:selectBooleanCheckbox value="#{registrationView.iacceptTermsAndConditions}" required="true" requiredMessage="aCCEPT TERMS"/>
                            </h:panelGrid>                            
                        </p:panel>
                    </p:tab>
                    <!-- Input security code from email -->
                    <p:tab id="signupWzd1" title="Account Password">
                        <p:panel header="Account Password2">
                            <p:messages showDetail="false" showIcon="false" closable="true"/>
                            <h:panelGrid columns="2" columnClasses="label, value">
                                <h:outputText value="New Password:" />
                                <p:password id="signupFormPwNew" label="new pw" value="#{registrationView.password}" required="true" 
                                            match="signupFormPwRetyped" feedback="true" inline="true" promptLabel="Pw strength" 
                                            weakLabel="weak" goodLabel="good" strongLabel="Strong" maxlength="32" >
                                    <f:validator validatorId="passwordValidator" />
                                </p:password>

                                <h:outputText value="Retype Password:" />
                                <p:password id="signupFormPwRetyped" label="ret pw" required="true" feedback="false"/>
                                
                                <h:outputText value="Emailed secret:" />
                                <p:inputText value="#{registrationView.emailedregistrationsecret}" required="true" requiredMessage="check ur email!"/>
                                
                                <h:inputHidden id="signupWzdHidden" value="#{registrationView.actionsecret}" />
                            </h:panelGrid>
                        </p:panel>
                    </p:tab>
                    <!--  -->
                    <p:tab id="signupWzd2" title="Account registerd" >
                        <p:panel header="Account Registered2">
                            <p:messages showDetail="false" showIcon="false" closable="true"/>
                            <h:panelGrid rendered="true" columns="2" columnClasses="label, value">
                                <h:outputText rendered="#{not registrationView.registered}" value="Account not created..." />
                                <h:outputText rendered="#{registrationView.registered}" value="Account succesfully created..." />
                                <p:outputLabel rendered="#{not registrationView.registered}" value="Please register or try reset again."/>
                                <p:outputLabel rendered="#{registrationView.registered}" value="Close by choosing next and sign in!"/>
                            </h:panelGrid>
                        </p:panel>
                    </p:tab>
                    <p:tab id="signupWzd9"  title="" titleStyleClass="ui-wizard-step-title-custom fa fa-check fa-2x">
                    </p:tab>
                </p:wizard>
            </h:form>
        </p:dialog>
        <!-- Signin dialog -->
        <p:dialog rendered="#{not mgr.authenticated()}" modal="true" header="Sign in" widgetVar="signinDlg" resizable="false">
            <h:form id="signinForm">
                <h:panelGrid id="signin" columns="1">
                    <f:facet name="header">
                        <p:row>
                            <p:column colspan="2">
                                <p:outputPanel >
                                    Register by filling out info below <p:commandLink value="link" />. 
                                </p:outputPanel>
                            </p:column>
                            <br />
                        </p:row>
                    </f:facet>

                    <p:outputLabel rendered="false" for="username" value="Username:" />
                    <p:inputText id="username" value="#{mgr.username}" required="true" >
                        <span class="fa fa-envelope-o" style="margin-right: 5px;"/>
                        <f:validateLength minimum="1" />
                    </p:inputText>
                    <p:watermark for="username" value="usename" />

                    <p:outputLabel rendered="false" for="password" value="Password:" />
                    <p:password id="password" value="#{mgr.password}" required="true" >
                        <span class="fa fa-key" style="margin-right: 5px;"/>
                    </p:password>
                    <p:watermark for="password" value="password" />

                    <p:row>
                        <p:column colspan="2">
                            <i class="fa fa-unlock-alt" style="margin-right: 10px;"/>
                            <p:commandLink id="cmdReset" value="Reset password?" onclick="PF('resetWzd').show();" oncomplete="PF('signinDlg').hide()"/>
                        </p:column>
                    </p:row>

                    <p:outputPanel id="signinResult">
                        <h:message for="signinResult" styleClass="ui-outputlabel ui-widget ui-state-error" />
                    </p:outputPanel>
                    
                    <p:outputLabel value="" />
                    <p:outputPanel>
                        <p:commandButton value="Cancel" icon="fa fa-close" onclick="PF('signinDlg').hide();" 
                                         update="signin"/>
                        <p:commandButton value="Sign in" icon="fa fa-check" oncomplete="JS.handleLoginRequest('signinDlg', xhr, status, args)" 
                                         update="signin,signinResult" action="#{mgr.submit}" />
                    </p:outputPanel>
                </h:panelGrid>
            </h:form>
        </p:dialog><!-- /Signin dialog -->
        <!-- Credentials dialog -->
        <p:dialog rendered="#{mgr.authenticated()}" modal="true" header="Change Password" widgetVar="credentialsDlg" resizable="false">
            <h:form id="credentialsForm">
                <p:messages showDetail="false" showIcon="false" closable="true"/>
                <h:panelGrid id="credentials" columns="2" >
                    <f:facet name="header">
                        <p:row>
                            <p:column colspan="2">
                                <p:outputPanel >
                                    Change password 
                                </p:outputPanel>
                            </p:column>
                        </p:row>
                    </f:facet>
                    
                    <p:outputLabel for="credentialsUsername" value="Username:" />
                    <p:inputText id="credentialsUsername" value="#{changePasswordView.username}" readonly="true"/>
                    
                    <p:outputLabel for="credentialsOldPassword" value="Old password:" />
                    <p:password id="credentialsOldPassword" value="#{changePasswordView.password}" required="true" />
                    
                    <p:outputLabel for="credentialsNewPassword" value="New Password:" />
                    <p:password id="credentialsNewPassword" label="new pw" value="#{changePasswordView.newPassword}" required="true" 
                                match="credentialsVerifiedPassword" feedback="true" inline="true" promptLabel="Pw strength" 
                                weakLabel="weak" goodLabel="good" strongLabel="Strong" maxlength="32" >
                        <f:validator validatorId="passwordValidator" />
                    </p:password>

                    <p:outputLabel for="credentialsVerifiedPassword" value="Retype Password:" />
                    <p:password id="credentialsVerifiedPassword" label="ret pw" required="true" feedback="false"/>
                    
                    <p:outputLabel value="" />
                    
                    <p:outputPanel>
                        <p:commandButton value="Cancel" onclick="PF('credentialsDlg').hide();" />
                        <p:commandButton value="Change" actionListener="#{changePasswordView.change()}"
                                         update="@form" />
                    </p:outputPanel>
                </h:panelGrid>
            </h:form>
        </p:dialog><!-- /Credentials dialog -->
        <!-- Localisation dialog -->
        <p:dialog rendered="#{mgr.authenticated()}" modal="true" header="Update Localisation" widgetVar="localisationDlg" resizable="false">
            <h:form id="localisationForm">
                <p:messages showDetail="false" showIcon="false" closable="true"/>
                <h:panelGrid id="localisation" columns="2" >
                    <f:facet name="header">
                        <p:row>
                            <p:column colspan="2">
                                <p:outputPanel >
                                    Localisation
                                </p:outputPanel>
                            </p:column>
                        </p:row>
                    </f:facet>

                    <p:outputLabel for="localisationLanguage" value="Loc Language:"/>
                    <p:selectOneMenu styleClass="localisationLanguage" id="localisationLanguage" value="#{changeLocalisationView.language}" effect="fade" var="ll" filter="true" filterMatchMode="startsWith">
                        <f:selectItems value="#{changeLocalisationView.localizedLanguages()}" var="lls" itemValue="#{lls}" />
                    </p:selectOneMenu>
                    
                    <p:outputLabel for="localisationCountry" value="Loc Country:"/>
                    <p:selectOneMenu styleClass="localisationLanguage" id="localisationCountry" value="#{changeLocalisationView.country}" effect="fade" var="lc" filter="true" filterMatchMode="startsWith">
                        <f:selectItems value="#{changeLocalisationView.localizedCountries()}" var="lcs" itemValue="#{lcs}" />
                    </p:selectOneMenu>

                    <p:outputLabel for="localisationCity" value="City:" />
                    <p:inputText styleClass="localisationLanguage" id="localisationCity" value="#{changeLocalisationView.city}" required="false" validatorMessage="where do you live?" >
                        <f:validateLength minimum="1" />
                    </p:inputText>
                    
                    <p:outputLabel for="localisationTimezone" value="Timezone:"/>
                    <p:selectOneMenu styleClass="localisationLanguage" id="localisationTimezone" value="#{changeLocalisationView.timezone}" effect="fade" var="t" filter="true" filterMatchMode="startsWith">
                        <f:selectItems value="#{changeLocalisationView.localizedTimezones()}" var="ts" itemValue="#{ts}" />
                    </p:selectOneMenu>
                    
                    <p:outputLabel value="" />
                    <p:outputPanel>
                        <p:commandButton value="Cancel" onclick="PF('localisationDlg').hide();" />
                        <p:commandButton value="Update" actionListener="#{changeLocalisationView.change()}" 
                                         update="@form" />
                    </p:outputPanel>
                </h:panelGrid>
            </h:form>
        </p:dialog><!-- /Localisation dialog -->
        <!-- Reset Wizard -->
        <p:dialog widgetVar="resetWzd" closable="true" header="Reset password" modal="true" styleClass="disable-scroll" width="600px">
            <h:form id="resetForm" >
                <p:growl id="resetFormGrowl" sticky="true" showDetail="true"/>
                <p:wizard widgetVar="resetWzdWizard" flowListener="#{resetPasswordView.onFlowProcess}" backLabel="Cancel" nextLabel="OK" showNavBar="true">
                    <!-- Send email if information is correct -->
                    <p:tab id="resetWzd0" title="Account Details">
                        <p:panel header="Account Details2">
                            <p:messages showDetail="false" showIcon="false" closable="true"/>
                            <h:panelGrid columns="2" columnClasses="label, value">
                                <h:outputText value="Email:" />
                                <p:inputText id="resetFormEmail" label="Email" value="#{resetPasswordView.username}" required="true">
                                    <f:validator validatorId="emailValidator" />
                                </p:inputText>

                                <h:outputText value="Mobile:" />
                                <p:inputText id="resetFormMobile" label="Mobile" value="#{resetPasswordView.mobile}" required="true">
                                    <f:validator validatorId="mobileValidator" />
                                </p:inputText>
                                
                                <h:outputText value="I am human:" />
                                <p:selectBooleanCheckbox value="#{resetPasswordView.iamhuman}" required="true" requiredMessage="Please check this"/>
                                <!-- Waiting for new Re-captcha integration from Primefaces -->
                            </h:panelGrid>
                        </p:panel>
                    </p:tab>
                    <!-- Input security code from email -->
                    <p:tab id="resetWzd1" title="Reset Password">
                        <p:panel header="Reset Password2">
                            <p:messages showDetail="false" showIcon="false" closable="true"/>
                            <h:panelGrid columns="2" columnClasses="label, value">
                                <h:outputText value="New Password:" />
                                <p:password id="resetFormPwNew" label="new pw" value="#{resetPasswordView.password}" required="true" 
                                            match="resetFormPwRetyped" feedback="true" inline="true" promptLabel="Pw strength" 
                                            weakLabel="weak" goodLabel="good" strongLabel="Strong" maxlength="32" >
                                    <f:validator validatorId="passwordValidator" />
                                </p:password>

                                <h:outputText value="Retype Password:" />
                                <p:password id="resetFormPwRetyped" label="ret pw" required="true" feedback="false"/>

                                <h:outputText value="Reset Code:" />
                                <p:inputText id="resetWzdEmailed" value="#{resetPasswordView.emailedsecret}" required="true" requiredMessage="Plz check your email!"/>
                                
                                <h:inputHidden id="resetWzdHidden" value="#{resetPasswordView.actionsecret}" />
                                
                            </h:panelGrid>
                        </p:panel>
                    </p:tab>
                    <!--  -->
                    <p:tab id="resetWzd2" title="Password reseted" >
                        <p:panel header="Password now changed">
                            <p:messages showDetail="false" showIcon="false" closable="true"/>
                            <h:panelGrid rendered="true" columns="2" columnClasses="label, value">
                                <h:outputText rendered="#{not resetPasswordView.reseted}" value="Password not reseted..." />
                                <h:outputText rendered="#{resetPasswordView.reseted}" value="Password succesfully reseted..." />
                                <p:outputLabel rendered="#{not resetPasswordView.reseted}" value="Please register or try reset again."/>
                                <p:outputLabel rendered="#{resetPasswordView.reseted}" value="Close by choosing next and sign in!"/>
                            </h:panelGrid>
                        </p:panel>
                    </p:tab>
                    <p:tab id="resetWzd9"  title="" titleStyleClass="ui-wizard-step-title-custom fa fa-lock fa-2x">
                    </p:tab>
                </p:wizard>
                
            </h:form>
        </p:dialog><!-- /Reset Wizard -->       
        <!-- 2FA for role change -->
        <p:dialog modal="true" header="2FA" widgetVar="fa2Dlg" resizable="false" closable="true">
            <h:form id="fa2Form">
                <h:panelGrid id="fa2Grid" columns="2" >
                    <f:facet name="header">
                        <p:row>
                            <p:column colspan="2">
                                <p:outputPanel >
                                    Change role? 
                                </p:outputPanel>
                            </p:column>
                        </p:row>
                    </f:facet>
                    
                    <h:outputLabel rendered="#{switchRoleMenu.requires2FA()}" for="fa2PIN" value="PIN:" />
                    <p:inputText rendered="#{switchRoleMenu.requires2FA()}" id="fa2PIN" value="#{switchRoleMenu.pin}" required="false" readonly="false" maxlength="8">
                        <p:ajax event="mouseout" listener="#{switchRoleMenu.flushPIN}" />
                    </p:inputText>
                    <p:outputLabel value="" />
                    <p:outputPanel>
                        <p:commandButton value="Cancel" onclick="PF('fa2Dlg').hide();"/>
                        <p:commandButton value="Change" actionListener="#{switchRoleMenu.switchNow()}" update="@all"/>
                    </p:outputPanel>
                </h:panelGrid>
            </h:form>
        </p:dialog><!-- /2FA for role change -->
        <!-- Terms and conditions dialog -->
        <p:dialog widgetVar="termsCondsDialog" header="legal" modal="true" draggable="false" closable="true" resizable="false" showHeader="true" >
            <p:panel id="basic" header="Terms and conditions" footer="" >
                <h:panelGrid columns="2" cellpadding="10">
                    <h:outputText value="The story begins as Don Vito Corleone..." />
                </h:panelGrid>
            </p:panel>
        </p:dialog><!-- /Terms and conditions dialog -->
        <!-- Loading... dialog -->
        <!--
        <p:dialog widgetVar="statusDialog" modal="true" draggable="false" closable="false" resizable="false" showHeader="false"  style="background: white">
            <p:graphicImage value="resources/images/spinning-gear.gif" />
        </p:dialog>
        -->
        <!-- Loading... dialog -->
        
        <!--
        <p:ajaxStatus onstart="PF('statusDialog').show()" onsuccess="PF('statusDialog').hide()" />
        -->
    </body>
</html>
