<!--
 ! Jeeplate
 ! Copyright (C) 2014 Jari Kuusisto
 ! 
 ! This program is free software: you can redistribute it and/or modify
 ! it under the terms of the GNU General Public License as published by
 ! the Free Software Foundation, either version 3 of the License, or
 ! (at your option) any later version.
 ! 
 ! This program is distributed in the hope that it will be useful,
 ! but WITHOUT ANY WARRANTY; without even the implied warranty of
 ! MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 ! GNU General Public License for more details.
 ! 
 ! You should have received a copy of the GNU General Public License
 ! along with this program. If not, see <http://www.gnu.org/licenses/>.
 ! 
 !-->
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" 
      xmlns:h="http://xmlns.jcp.org/jsf/html" 
      xmlns:f="http://xmlns.jcp.org/jsf/core" 
      xmlns:p="http://primefaces.org/ui" >
    <body>
        <!-- Menubar -->
        <h:form id="menubarForm">
            <p:growl id="growlMessages" showDetail="true" life="3000" />

            <p:menubar>
                <p:menuitem id="logo">
                    <p:outputLabel>
                        <p:graphicImage style="height:25px;width:25px" value="resources/images/football.png" />
                    </p:outputLabel>
                    <p:outputLabel value="JEE" />
                </p:menuitem>

                <f:facet name="options">
                    <p:splitButton value="JEE USER2" immediate="true" rendered="#{mgr.authenticated()}" actionListener="#{buttonView.save}" icon="ui-icon-disk">
                        <p:menuitem value="Change credentials..." onclick="PF('credentialsDlg').show();" actionListener="#{oracle.noop()}" update="growlMessages" icon="ui-icon-arrowrefresh-1-w" />
                        <p:menuitem value="Update localisation..." onclick="PF('localisationDlg').show();" actionListener="#{oracle.noop()}" update="growlMessages" icon="ui-icon-arrowrefresh-1-w" />
                        <p:menuitem value="Modify account settings..." action="account" actionListener="#{oracle.noop()}" update="growlMessages" icon="ui-icon-arrowrefresh-1-w" />
                    </p:splitButton>

                    <p:splitButton value="admin" immediate="true" rendered="#{mgr.authenticated()}" actionListener="#{oracle.noop()}" icon="ui-icon-disk">
                        <p:menuitem value="sysadmin" onclick="JS.handleRoleSwitch('roleDlg','roleForm:roleNewrole','#{mgr.sysadmin()}');" actionListener="#{oracle.noop()}" update="growlMessages" icon="ui-icon-arrowrefresh-1-w" />
                        <p:menuitem value="user" onclick="JS.handleRoleSwitch('roleDlg','roleForm:roleNewrole','user');" actionListener="#{oracle.noop()}" update="growlMessages" icon="ui-icon-arrowrefresh-1-w" />
                    </p:splitButton>

                    <p:commandButton value="Sign up" rendered="#{not mgr.authenticated()}" icon="ui-icon-disk"
                                     onclick="PF('signupWzd').show();">
                    </p:commandButton>

                    <p:commandButton value="Sign in" rendered="#{not mgr.authenticated()}" icon="ui-icon-disk"
                                     onclick="PF('signinDlg').show();">
                    </p:commandButton>

                    <p:commandButton value="Sign out" rendered="#{mgr.authenticated()}" icon="ui-icon-disk"
                                     ajax="false" action="#{mgr.doLogout}">
                    </p:commandButton>
                    
                    <!-- Primefaces' splitbutton cannot process dynamic lists, so we use this -->
                    <h:outputLabel for="syslang" value="syslang"/>
                   
                        <p:inplace id="syslang" widgetVar="test" effect="none" label="#{language.getLocalisedLanguage()}">
                            <h:selectOneMenu styleClass="selectLang" valueChangeListener="#{language.changeLanguage}">
                                <p:ajax update="@all" />
                                <f:selectItems value="#{language.availableLanguages}" />
                            </h:selectOneMenu>
                        </p:inplace>
                    
                </f:facet>
            </p:menubar>
        </h:form>
        <!-- /Menubar -->
        <!-- Signup dialog -->
        <p:dialog closable="false" rendered="true" widgetVar="signupWzd" header="Sign up" modal="true" styleClass="disable-scroll" width="600px">
            <h:form id="signupForm">
                <p:growl id="signupFormGrowl" sticky="true" showDetail="true"/>
                <p:wizard widgetVar="signupWzdWizard" flowListener="#{registrationView.onFlowProcess}" backLabel="Cancel" nextLabel="OK" showNavBar="true">
                    <!-- Send email if information is correct -->
                    <p:tab id="signupWzdStart" title="Register Account">
                        <p:panel header="Register Account2">
                            <p:messages showDetail="true" showIcon="false"/>
                            <h:panelGrid columns="2" columnClasses="label, value">
                                <h:outputText value="Email:" />
                                <p:inputText value="#{registrationView.email}" required="true" />

                                <h:outputText value="Mobile:" />
                                <p:inputText value="#{registrationView.mobile}" required="true" />

                                <h:outputText value="I Accept Terms and Conditions:" />
                                <p:selectBooleanCheckbox value="#{registrationView.iacceptTermsAndConditions}" required="true"/>
                                
                                <h:inputHidden id="signupWzdHidden" value="#{registrationView.hidden}" />
                            </h:panelGrid>                            
                        </p:panel>
                    </p:tab>
                    <!-- Input security code from email -->
                    <p:tab id="signupWzdAccount" title="Account Password">
                        <p:panel header="Account Password2">
                            <p:messages showDetail="true" showIcon="false"/>
                            <h:panelGrid columns="2" columnClasses="label, value">
                                <h:outputText value="New Password:" />
                                <p:password id="resetFormPwNew" label="new pw" value="#{registrationView.password}" required="true" feedback="false" match="resetFormPwRetyped"/>

                                <h:outputText value="Retype Password:" />
                                <p:password id="resetFormPwRetyped" label="ret pw" value="#{registrationView.password}" required="true" feedback="false"/>

                                <h:outputText value="Domain Code: " />
                                <p:inputText value="#{registrationView.securitycode}" required="true" >
                                    <f:param name="signupWzdHidden" value="#{registrationView.hidden}" />
                                </p:inputText>
                            </h:panelGrid>
                        </p:panel>
                    </p:tab>
                    <!--  -->
                    <p:tab id="signupWzdInfo" title="Account registerd" >
                        <p:panel header="Account Registered2">
                            <p:messages />
                            <h:panelGrid columns="2" columnClasses="label, value">
                                <p:outputLabel value="Close by choosing next!"/>
                            </h:panelGrid>
                        </p:panel>
                    </p:tab>
                    <p:tab id="signupWzdStop"  title="" titleStyleClass="ui-wizard-step-title-custom fa fa-check fa-2x">

                    </p:tab>
                </p:wizard>
                
            </h:form>
            
        </p:dialog>
        <!--<p:dialog rendered="{not mgr.authenticated()}" modal="true" header="Sign up" widgetVar="signupDlg" resizable="false">
            <h:form id="signupForm">
                <h:panelGrid id="signup" columns="1" >
                    <f:facet name="header">
                        <p:row>
                            <p:column colspan="2">
                                <p:outputPanel >
                                    Register by filling out info below <p:commandLink value="link" />. 
                                </p:outputPanel>
                            </p:column>
                        </p:row>
                    </f:facet>

                    <p:outputLabel for="signupEmail" value="Email:" />
                    
                    <p:inputText styleClass="signupEmail" id="signupEmail" value="{mgr.username}" required="true" >
                        <p:graphicImage style="height:25px;width:25px" value="resources/images/football.png" />
                        
                    </p:inputText>
                    <p:watermark for="signupEmail" value="user.name@email.com" />

                    <p:outputLabel for="signupMobile" value="Mobile:" />
                    
                    <p:password id="signupMobile" value="{mgr.password}" required="true">
                        <p:graphicImage style="height:25px;width:25px" value="resources/images/football.png" />
                    </p:password>
                    <p:watermark for="signupMobile" value="+358 12 3456789" />

                    <p:commandLink value="Terms &amp; conds" onclick="PF('termsCondsDialog').show()" />
                    <p:outputPanel id="signupResult">
                        <h:message for="signupResult" styleClass="ui-outputlabel ui-widget ui-state-error" />
                    </p:outputPanel>

                    <p:outputLabel value="" />
                    <p:outputPanel>
                        <p:commandButton value="Sign up" oncomplete="JS.handleLoginRequest('signupDlg', xhr, status, args)" 
                                         update="signup" action="{mgr.submit}" />

                        <p:commandButton value="Cancel" immediate="true" onclick="PF('signupDlg').hide();" 
                                         update="signup,signupResult"/>
                    </p:outputPanel>
                </h:panelGrid>
            </h:form>
        </p:dialog>--><!-- /Signup dialog -->
        <!-- Signin dialog -->
        <p:dialog rendered="#{not mgr.authenticated()}" modal="true" header="Sign in" widgetVar="signinDlg" resizable="false">
            <h:form id="signinForm">
                <h:panelGrid id="signin" columns="1">
                    <f:facet name="header">
                        <p:row>
                            <p:column colspan="2">
                                <p:outputPanel >
                                    Register by filling out info below <p:commandLink value="link" />. 
                                </p:outputPanel>
                            </p:column>
                            <br />
                        </p:row>
                    </f:facet>

                    <p:outputLabel rendered="false" for="username" value="Username:" />
                    <p:inputText id="username" value="#{mgr.username}" required="true" >
                        <span class="fa fa-envelope-o" style="margin-right: 5px;"/>
                        <f:validateLength minimum="1" />
                    </p:inputText>
                    <p:watermark for="username" value="usename" />

                    <p:outputLabel rendered="false" for="password" value="Password:" />
                    <p:password id="password" value="#{mgr.password}" required="true" >
                        <span class="fa fa-key" style="margin-right: 5px;"/>
                    </p:password>
                    <p:watermark for="password" value="password" />

                    <p:row>
                        <p:column colspan="2">
                            <i class="fa fa-unlock-alt" style="margin-right: 10px;"/>
                            <p:commandLink id="cmdReset" value="Reset password?" onclick="PF('resetWzd').show();" oncomplete="PF('signinDlg').hide()">
                            </p:commandLink>
                        </p:column>
                    </p:row>

                    <p:outputPanel id="signinResult">
                        <h:message for="signinResult" styleClass="ui-outputlabel ui-widget ui-state-error" />
                    </p:outputPanel>
                    
                    <p:outputLabel value="" />
                    <p:outputPanel>
                        <p:commandButton value="Cancel" icon="fa fa-close" 
                                         immediate="true" onclick="PF('signinDlg').hide();" 
                                         update="signin,signinResult"/>
                        <p:commandButton value="Sign in" icon="fa fa-check" 
                                         oncomplete="JS.handleLoginRequest('signinDlg', xhr, status, args)" 
                                         update="signin" action="#{mgr.submit}" />
                    </p:outputPanel>
                </h:panelGrid>
            </h:form>
        </p:dialog><!-- /Signin dialog -->
        <!-- Credentials dialog -->
        <p:dialog rendered="#{mgr.authenticated()}" modal="true" header="Change Password" widgetVar="credentialsDlg" resizable="false">
            <h:form id="credentialsForm">
                <h:panelGrid id="credentials" columns="2" >
                    <f:facet name="header">
                        <p:row>
                            <p:column colspan="2">
                                <p:outputPanel >
                                    Change pw by filling out info below <p:commandLink value="link" />. 
                                </p:outputPanel>
                            </p:column>
                        </p:row>
                    </f:facet>
                    
                    <h:outputLabel for="credentialsUsername" value="Username:" />
                    <h:inputText id="credentialsUsername" value="info@sis.to" readonly="true"/>
                    
                    <p:outputLabel for="credentialsPassword" value="Old password:" />
                    <p:password id="credentialsPassword" value="" required="true" />

                    <p:outputLabel for="credentialsNewPassword" value="New password:" />
                    <p:inputText id="credentialsNewPassword" value="***" required="true" >
                        <f:validateLength minimum="1" />
                    </p:inputText>
                    
                    <p:outputLabel for="credentialsVerifyPassword" value="Verify it:" />
                    <p:inputText id="credentialsVerifyPassword" value="***" required="true" >
                        <f:validateLength minimum="1" />
                    </p:inputText>
                    
                    <p:commandLink value="Terms &amp; Conditions" />
                    <p:outputPanel id="credentialsResult">
                        <h:message for="credentialsResult" styleClass="ui-outputlabel ui-widget ui-state-error" />
                    </p:outputPanel>
                    
                    <p:outputLabel value="" />
                    <p:outputPanel>
                        <p:commandButton value="Change" oncomplete="JS.handleLoginRequest('signupDlg', xhr, status, args)" 
                                         update="credentials" action="#{mgr.submit}" />

                        <p:commandButton value="Cancel" immediate="true" onclick="PF('signupDlg').hide();" 
                                         update="credentials,credentialsResult"/>
                    </p:outputPanel>
                </h:panelGrid>
            </h:form>
        </p:dialog><!-- /Credentials dialog -->
        <!-- Localisation dialog -->
        <p:dialog rendered="#{mgr.authenticated()}" modal="true" header="Update Localisation" widgetVar="localisationDlg" resizable="false">
            <h:form id="localisationForm">
                <h:panelGrid id="localisation" columns="2" >
                    <f:facet name="header">
                        <p:row>
                            <p:column colspan="2">
                                <p:outputPanel >
                                    Change pw by filling out info below <p:commandLink value="link" />. 
                                </p:outputPanel>
                            </p:column>
                        </p:row>
                    </f:facet>
                    
                    <h:outputLabel for="localisationLanguage" value="Language:" />
                    <h:inputText id="localisationLanguage" value="Suomi" readonly="true"/>
                    
                    <p:outputLabel for="localisationTimezone" value="Timezone:" />
                    <p:inputText id="localisationTimezone" value="UTC" required="true" />
                    
                    <p:outputLabel for="localisationCountry" value="Country:" />
                    <p:inputText id="localisationCountry" value="Finland" required="false" >
                        <f:validateLength minimum="1" />
                    </p:inputText>

                    <p:outputLabel for="localisationCity" value="City:" />
                    <p:inputText id="localisationCity" value="Helsinki" required="false" >
                        <f:validateLength minimum="1" />
                    </p:inputText>
                    
                    <p:commandLink value="Terms &amp; Conditions" />
                    <p:outputPanel id="localisationResult">
                        <h:message for="localisationResult" styleClass="ui-outputlabel ui-widget ui-state-error" />
                    </p:outputPanel>

                    <p:outputLabel value="" />
                    <p:outputPanel>
                        <p:commandButton value="Update" oncomplete="JS.handleLoginRequest('signupDlg', xhr, status, args)" 
                                         update="localisation" action="#{mgr.submit}" />

                        <p:commandButton value="Cancel" immediate="true" onclick="PF('signupDlg').hide();" 
                                         update="localisation,localisationResult"/>
                    </p:outputPanel>
                </h:panelGrid>
            </h:form>
        </p:dialog><!-- /Localisation dialog -->
        <!-- Role dialog -->
        <p:dialog rendered="#{mgr.authenticated()}" modal="true" header="Sign as" widgetVar="roleDlg" resizable="false">
            <h:form id="roleForm">
                <h:panelGrid id="role" columns="1" >
                    <f:facet name="header">
                        <p:row>
                            <p:column colspan="2">
                                <p:outputPanel >
                                    <h:outputText value="Switch role to"/>
                                    <h:outputLabel id="roleNewrole" value="" />
                                </p:outputPanel>
                            </p:column>
                        </p:row>
                    </f:facet>
                    
                    <h:outputLabel for="roleUsername" value="Username:" />
                    <h:inputText id="roleUsername" value="jari" readonly="true"/>
                    
                    <p:outputLabel for="rolePassword" value="Password:" />
                    <p:password id="rolePassword" value="vv" required="true" />
                    
                    <p:commandLink value="Terms &amp; Conditions" />
                    <p:outputPanel id="roleResult">
                        <h:message for="roleResult" styleClass="ui-outputlabel ui-widget ui-state-error" />
                    </p:outputPanel>

                    <p:outputLabel value="" />
                    <p:outputPanel>
                        <p:commandButton value="Switch" oncomplete="JS.handleLoginRequest('signupDlg', xhr, status, args)" 
                                         update="role" action="#{mgr.submit}" />

                        <p:commandButton value="Cancel" immediate="true" onclick="PF('signupDlg').hide();" 
                                         update="role,roleResult"/>
                    </p:outputPanel>
                </h:panelGrid>
            </h:form>
        </p:dialog><!-- /Role dialog -->
        <!-- Reset Wizard -->
        <p:dialog widgetVar="resetWzd" closable="true" header="Reset password" modal="true" styleClass="disable-scroll" width="600px">
            <h:form id="resetForm" >
                <p:growl id="resetFormGrowl" sticky="true" showDetail="true"/>
                <p:wizard widgetVar="resetWzdWizard" flowListener="#{passwordView.onFlowProcess}" backLabel="Cancel" nextLabel="OK" showNavBar="true">
                    <!-- Send email if information is correct -->
                    <p:tab id="resetWzd0" title="Account Details">
                        <p:panel header="Account Details2">
                            <p:messages showDetail="false" showIcon="false" closable="true"/>
                            <h:panelGrid columns="2" columnClasses="label, value">
                                <h:outputText value="Email:" />
                                <p:inputText id="resetFormEmail" label="Email" value="#{passwordView.email}" required="true">
                                    <f:validator validatorId="emailValidator" />
                                </p:inputText>

                                <h:outputText value="Mobile:" />
                                <p:inputText id="resetFormMobile" label="Mobile" value="#{passwordView.mobile}" required="true">
                                    <f:validator validatorId="mobileValidator" />
                                </p:inputText>

                                <h:outputText value="I am human:" /><!-- Waiting for new Re-captcha integration from Primefaces -->
                                <p:selectBooleanCheckbox  label="Captcha" value="#{passwordView.iamhuman}" required="true"/>
                                
                                <!-- hidden value generated -->
                            </h:panelGrid>
                        </p:panel>
                    </p:tab>
                    <!-- Input security code from email -->
                    <p:tab id="resetWzd1" title="Change Password">
                        <p:panel header="Change Password2">
                            <p:messages showDetail="false" showIcon="false" closable="true"/>
                            <h:panelGrid columns="2" columnClasses="label, value">
                                <h:outputText value="New Password:" />
                                <p:password id="resetFormPwNew" label="new pw" value="#{passwordView.password}" required="true" 
                                            match="resetFormPwRetyped" feedback="true" inline="true" promptLabel="Pw strength" 
                                            weakLabel="weak" goodLabel="good" strongLabel="Strong" maxlength="32" >
                                    <f:validator validatorId="passwordValidator" />
                                </p:password>

                                <h:outputText value="Retype Password:" />
                                <p:password id="resetFormPwRetyped" label="ret pw" required="true" feedback="false"/>

                                <h:outputText value="Reset Code:" />
                                <h:inputText id="resetWzdEmailed" value="#{passwordView.emailedsecret}" required="true" />
                                
                                <h:inputHidden id="resetWzdHidden" value="#{passwordView.actionsecret}" />
                                
                            </h:panelGrid>
                        </p:panel>
                    </p:tab>
                    <!--  -->
                    <p:tab id="resetWzd2" title="Password reseted" >
                        <p:panel header="Password now changed">
                            <p:messages showDetail="false" showIcon="false" closable="true"/>
                            <h:panelGrid rendered="true" columns="2" columnClasses="label, value">
                                <h:outputText rendered="#{not passwordView.reseted}" value="Password not reseted..." />
                                <h:outputText rendered="#{passwordView.reseted}" value="Password succesfully reseted..." />
                                <p:outputLabel rendered="#{not passwordView.reseted}" value="Please register or try reset again."/>
                                <p:outputLabel rendered="#{passwordView.reseted}" value="Close by choosing next and sign in!"/>
                            </h:panelGrid>
                        </p:panel>
                    </p:tab>
                    <p:tab id="resetWzd9"  title="" titleStyleClass="ui-wizard-step-title-custom fa fa-lock fa-2x">
                        <span onloadstart="document.getElementById('resetForm').submit();">One ugly PrimeFaces hack</span>
                    </p:tab>
                </p:wizard>
                
            </h:form>
        </p:dialog><!-- /Reset Wizard -->
        <!-- Terms and conditions dialog -->
        <p:dialog widgetVar="termsCondsDialog" header="legal" modal="true" draggable="false" closable="true" resizable="false" showHeader="true" >
            <p:panel id="basic" header="Terms and conditions" footer="" >
                <h:panelGrid columns="2" cellpadding="10">
                    <h:outputText value="The story begins as Don Vito Corleone..." />
                </h:panelGrid>
            </p:panel>
        </p:dialog><!-- /Terms and conditions dialog -->
        <!-- Loading... dialog -->
        <p:dialog widgetVar="statusDialog" modal="true" draggable="false" closable="false" resizable="false" showHeader="false"  style="background: white">
            <p:graphicImage value="resources/images/spinning-gear.gif" />
        </p:dialog><!-- Loading... dialog -->
        <p:ajaxStatus onstart="PF('statusDialog').show()" onsuccess="PF('statusDialog').hide()" />
    </body>
</html>
